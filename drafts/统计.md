# 统计
参考百度统计

# TODO
* 可以清除当前统计数据

# 统计项
* 访问量最多
* 最耗时
         
   总体控制 | 单IP | 单用户 | 单请求 | 日 | 当天 | 周 | 月 | 年 | 最近7天 | 最近30天
UV 
PV

# 界面
~~~

当天|最近7天|最近30天|日|周|...
|                                                   |
| line chart                                        |
|                                                   |

----------------------------------------------------------------------------

|------------|       |--------|   |
|            |       |        |   | 地区统计 | 中国大陆内地（地图展示） | 操作系统统计 | 浏览器统计 |
| 访问量最多   |      | 最耗时  |   |           
|             |      |        |             
|-------------|      |--------|



~~~~

# 数据结构
## 数据库
~~~
teaweb/
  # 访问日志  
  logs.access.201809
  logs.access.201810
  ...
  
  # UV
  stats.uv.201809
  ....
  
  stats.uv.20180901
  ...
  
  # PV
  stats.pv.201809
  ...
  
  stats.pv.20180901
  ...
  
  # 地区
  stats.regions
  ...
  
  # 中国大陆内地
  stats.provinces
  ...
  
  # 操作系统
  stats.os
  ...
  
  # 浏览器
  stats.browsers
  ...
~~~

## 日志
日志增加 `isProcessed` 字段：
~~~
{
    "isProcessed": false
}
~~~
然后在后面的进程中处理

## stats数据结构
~~~
{
    "pv": ...,
    "uv": ...,
    "day": ...,
    "hours": [
        {
            "hour": 1,
            "pv": ...,
            ...
        },
        ...
    ]
}
~~~

# requests请求
~~~
{
    "url": ...,
    "avgCost": ...,
    "totalRequests": ...,
    "totalCosts": ...,
    "serverId": ...
}
~~~

# dailyRequests每日请求
~~~
{
    "day": "20181002",
    "url": ...,
    "avgCost": ...,
    "totalRequests": ...,
    "totalCosts": ...,
    "serverId": ...
}
~~~

# hourlyRequests每日请求
~~~
{
    "day": "20181002",
    "hour": 1,
    "url": ...,
    "avgCost": ...,
    "totalRequests": ...,
    "totalCosts": ...,
    "serverId": ...
}
~~~

# stats.$统计项 系列
~~~
{
    "$统计项":...,
    "total": ...,
    "dayFrom": ..., 
    "serverId": ...
}
~~~

